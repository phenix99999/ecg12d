{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import*as React from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import SyncStorage from'sync-storage';import EventBus from'react-native-event-bus';import{Root}from\"native-base\";import{inject,observer}from\"mobx-react\";import{Toast,Content,Left,Right,Icon,Text,Body,Button,Container,Header,Form}from\"native-base\";import Image from\"react-native-web/dist/exports/Image\";import ImageBackground from\"react-native-web/dist/exports/ImageBackground\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import View from\"react-native-web/dist/exports/View\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import NativeModules from\"react-native-web/dist/exports/NativeModules\";import{authentification,get}from\"../utils/connectorFileMaker\";import NetworkUtils from\"../utils/NetworkUtils\";var StatusBarManager=NativeModules.StatusBarManager;var keyboardDidHideListener;var LoginScreen=function LoginScreen(_ref){var navigation=_ref.navigation,authStore=_ref.authStore;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isLoading=_React$useState2[0],setLoading=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isLoadingTemp=_React$useState4[0],setLoadingTemp=_React$useState4[1];function onLogin(){var layout,user,setDataBillet,role,client;return _regeneratorRuntime.async(function onLogin$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:layout=\"mobile_ACCOUNT2\";if(isLoadingTemp){_context2.next=44;break;}setLoadingTemp(true);setLoading(true);_context2.next=6;return _regeneratorRuntime.awrap(authentification(authStore.username,authStore.password,global.fmServer,global.fmDatabase,layout,\"&_C_nomComplet=\"+authStore.username));case 6:user=_context2.sent;setDataBillet=function setDataBillet(){var billetsTemp,billets,indexBillet,i;return _regeneratorRuntime.async(function setDataBillet$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _regeneratorRuntime.awrap(get(authStore.username,authStore.password,global.fmServer,global.fmDatabase,\"mobile_ACTIVITES2\",\"&fk_assignation=\"+SyncStorage.get('user').pk_ID+\"&flag_billet=1&flag_actif=1\"));case 2:billetsTemp=_context.sent;billets=[];indexBillet=0;for(i=0;i<billetsTemp.length;i++){if(billetsTemp[i].Status!=\"FermÃ©\"){billets[indexBillet]=billetsTemp[i];indexBillet++;}}_context.next=8;return _regeneratorRuntime.awrap(SyncStorage.set('nbAssignation',billets.length));case 8:case\"end\":return _context.stop();}}},null,null,null,Promise);};if(!(user==-1)){_context2.next=14;break;}setLoading(false);setLoadingTemp(false);Toast.show({position:\"top\",text:\"Mauvais identifiants\"});_context2.next=44;break;case 14:role=\"\";SyncStorage.set('connected',true);SyncStorage.set('username',authStore.username);SyncStorage.set('user',user[0]);if(!(user[0].PrivilegeSet==1)){_context2.next=23;break;}_context2.next=21;return _regeneratorRuntime.awrap(SyncStorage.set('typeAccount',1));case 21:_context2.next=32;break;case 23:if(!(user[0].PrivilegeSet==2)){_context2.next=28;break;}_context2.next=26;return _regeneratorRuntime.awrap(SyncStorage.set('typeAccount',2));case 26:_context2.next=32;break;case 28:_context2.next=30;return _regeneratorRuntime.awrap(setDataBillet());case 30:_context2.next=32;return _regeneratorRuntime.awrap(SyncStorage.set('typeAccount',0));case 32:if(!(user[0].PrivilegeSet==1)){_context2.next=37;break;}_context2.next=35;return _regeneratorRuntime.awrap(get(authStore.username,authStore.password,global.fmServer,global.fmDatabase,\"mobile_CLIENTS2\",\"&Nom=\"+authStore.username));case 35:client=_context2.sent;SyncStorage.set('client_PK',client[0].pk_ID);case 37:EventBus.getInstance().fireEvent(\"prepareNavigation\");SyncStorage.set('password',authStore.password);navigation.goBack();authStore.password=\"\";navigation.navigate(\"Main\");setLoading(false);setLoadingTemp(false);case 44:case\"end\":return _context2.stop();}}},null,null,null,Promise);}function _keyboardDidHide(){return _regeneratorRuntime.async(function _keyboardDidHide$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!(!isLoadingTemp&&authStore.password.length>2)){_context3.next=4;break;}setLoadingTemp(true);_context3.next=4;return _regeneratorRuntime.awrap(onLogin());case 4:case\"end\":return _context3.stop();}}},null,null,null,Promise);}React.useEffect(function(){if(SyncStorage.get('username')){authStore.username=SyncStorage.get('username');}keyboardDidHideListener=Keyboard.addListener('keyboardDidHide',_keyboardDidHide);return function(){Keyboard.removeListener(\"keyboardDidHide\",_keyboardDidHide);};});if(!NetworkUtils.isNetworkAvailable()){alert(\"Erreur de connexion\");}return React.createElement(Root,null,isLoading?React.createElement(View,{style:[styles.container,styles.horizontal]},React.createElement(ActivityIndicator,{size:\"large\",color:\"black\"})):React.createElement(ImageBackground,{source:require(\"../assets/images/accueil.png\"),style:styles.imgBackground},React.createElement(Header,{style:{width:'100%',backgroundColor:'transparent'}},React.createElement(Left,null,React.createElement(Button,{onPress:function onPress(){navigation.goBack();},transparent:true},React.createElement(Icon,{name:\"back\",type:\"AntDesign\",style:{fontSize:30,marginLeft:2,color:'#1f4598'}}))),React.createElement(Body,null,React.createElement(Text,{style:{fontWeight:'bold'}},\" Portail \")),React.createElement(Right,null)),React.createElement(Container,{style:{flexGrow:1,flex:1,backgroundColor:'transparent'}},React.createElement(ScrollView,{style:{width:\"100%\"},contentContainerStyle:styles.content},React.createElement(Content,{style:{flexGrow:1,flex:1,flexDirection:\"row\"}},React.createElement(View,{style:[styles.subContainer,{justifyContent:\"flex-start\"}]},React.createElement(Form,{style:styles.form},React.createElement(Image,{style:{width:'100%'},resizeMode:\"contain\",source:require(\"../assets/images/vhiculeMedia.png\")}),React.createElement(TextInput,{placeholderTextColor:\"#404040\",style:{height:45,width:200,borderWidth:0.5,borderColor:'#303030',padding:7},value:authStore.username,onChange:function onChange(e){return authStore.username=e.nativeEvent.text;},placeholder:\"Nom d'utilisateur\"}),React.createElement(TextInput,{placeholderTextColor:\"#404040\",secureTextEntry:true,value:authStore.password,placeholder:\"Mot de passe\",onChange:function onChange(e){return authStore.password=e.nativeEvent.text;},style:{marginTop:10,height:45,width:200,borderWidth:0.5,borderColor:'#303030',padding:7}})),React.createElement(Button,{onPress:function _callee(){return _regeneratorRuntime.async(function _callee$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(onLogin());case 2:case\"end\":return _context4.stop();}}},null,null,null,Promise);},style:{justifyContent:'center',marginTop:52,backgroundColor:\"#1f4598\",height:40,width:'100%',borderWidth:0.5,borderColor:'#303030',padding:15}},React.createElement(Text,null,\" Connexion\"))))))));};export default inject(\"authStore\")(observer(LoginScreen));var styles=StyleSheet.create({container:{flex:1,justifyContent:\"center\"},horizontal:{flexDirection:\"row\",justifyContent:\"space-around\",padding:10},imgBackground:{width:\"100%\",height:\"100%\"},content:{flexDirection:\"column\",flex:1,flexGrow:1,width:\"100%\",alignItems:\"center\",justifyContent:\"center\"},button:{width:200,margin:20,alignSelf:\"center\",textAlign:\"center\",justifyContent:\"center\",backgroundColor:\"#0F29AC\"},horizontalRule:{borderBottomColor:\"black\",borderBottomWidth:1,marginTop:10,marginBottom:10},form:{backgroundColor:\"transparent\"},subContainer:{flex:1,justifyContent:\"center\"}});","map":{"version":3,"sources":["/Users/lyestamazouzt/Projects/CoffretsPrestige/src/screens/LoginScreen.tsx"],"names":["React","SyncStorage","EventBus","Root","inject","observer","Toast","Content","Left","Right","Icon","Text","Body","Button","Container","Header","Form","authentification","get","NetworkUtils","StatusBarManager","NativeModules","keyboardDidHideListener","LoginScreen","navigation","authStore","useState","isLoading","setLoading","isLoadingTemp","setLoadingTemp","onLogin","layout","username","password","global","fmServer","fmDatabase","user","setDataBillet","pk_ID","billetsTemp","billets","indexBillet","i","length","Status","set","show","position","text","role","PrivilegeSet","client","getInstance","fireEvent","goBack","navigate","_keyboardDidHide","useEffect","Keyboard","addListener","removeListener","isNetworkAvailable","alert","styles","container","horizontal","require","imgBackground","width","backgroundColor","fontSize","marginLeft","color","fontWeight","flexGrow","flex","content","flexDirection","subContainer","justifyContent","form","height","borderWidth","borderColor","padding","e","nativeEvent","marginTop","StyleSheet","create","alignItems","button","margin","alignSelf","textAlign","horizontalRule","borderBottomColor","borderBottomWidth","marginBottom"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { StyleSheet, SafeAreaView, FlatList, Alert } from \"react-native\";\nimport Constants from \"expo-constants\";\n\nimport { StackScreenProps } from \"@react-navigation/stack\";\nimport { LoginStackParamList, RootStackParamList } from \"../types\";\nimport SyncStorage from 'sync-storage';\nimport EventBus from 'react-native-event-bus'\n\nimport { Root } from \"native-base\";\nimport { inject, observer } from \"mobx-react\";\nimport {\n    Toast,\n    Title,\n    List,\n    ListItem,\n    Content,\n    Left,\n    Right,\n    Icon,\n    Text,\n    Body,\n    Button,\n    Container,\n    Header,\n    Form,\n    Item,\n    Input,\n    Spinner,\n} from \"native-base\";\nimport { Image, ImageBackground, RefreshControl, ScrollView, View, TextInput, Keyboard, ActivityIndicator, StatusBar, Platform, NativeModules } from \"react-native\";\nimport AuthStore from \"../stores/AuthStore\";\nimport { authentification, get } from '../utils/connectorFileMaker';\nimport NetworkUtils from '../utils/NetworkUtils';\n\nconst { StatusBarManager } = NativeModules;\ntype Props = {\n    authStore: AuthStore;\n} & StackScreenProps<RootStackParamList, \"Logout\">;\nimport RNRestart from 'react-native-restart'; // Import package from node modules\n\n\nlet keyboardDidHideListener;\n\nconst LoginScreen = ({ navigation, authStore }: Props) => {\n    const [isLoading, setLoading] = React.useState<Boolean>(false);\n    const [isLoadingTemp, setLoadingTemp] = React.useState<Boolean>(false);\n\n\n    async function onLogin() {\n        let layout = \"mobile_ACCOUNT2\";\n        if (!isLoadingTemp) {\n            setLoadingTemp(true);\n            setLoading(true);\n\n            let user = await authentification(authStore.username, authStore.password, global.fmServer, global.fmDatabase, layout, \"&_C_nomComplet=\" + authStore.username);\n\n            const setDataBillet = async () => {\n                let billetsTemp = await get(authStore.username, authStore.password, global.fmServer, global.fmDatabase, \"mobile_ACTIVITES2\"\n                    , \"&fk_assignation=\" + SyncStorage.get('user').pk_ID + \"&flag_billet=1&flag_actif=1\");\n                let billets = [];\n                let indexBillet = 0;\n                for (let i = 0; i < billetsTemp.length; i++) {\n                    if (billetsTemp[i].Status != \"FermÃ©\") {\n                        // console.log(billetsTemp[i]);\n                        billets[indexBillet] = billetsTemp[i];\n                        indexBillet++;\n                    }\n                }\n\n                await SyncStorage.set('nbAssignation', billets.length);\n\n            }\n\n\n\n\n\n\n            if (user == -1) {\n                // alert(\"Mauvais password\");\n                setLoading(false);\n                setLoadingTemp(false);\n                Toast.show({\n                    position: \"top\",\n                    text: \"Mauvais identifiants\",\n                });\n\n            } else {\n                // alert(\"Ici\");\n                let role = \"\";\n                SyncStorage.set('connected', true);\n                SyncStorage.set('username', authStore.username);\n                SyncStorage.set('user', user[0]);\n                //1 = client 0 = employe\n                if (user[0].PrivilegeSet == 1) {\n                    await SyncStorage.set('typeAccount', 1)\n                } else if (user[0].PrivilegeSet == 2) {\n                    await SyncStorage.set('typeAccount', 2)\n                } else {\n                    await setDataBillet();\n                    await SyncStorage.set('typeAccount', 0);\n                }\n\n                if (user[0].PrivilegeSet == 1) {\n                    //Client id\n                    let client = await get(authStore.username, authStore.password, global.fmServer, global.fmDatabase, \"mobile_CLIENTS2\"\n                        , \"&Nom=\" + authStore.username);\n\n                    SyncStorage.set('client_PK', client[0].pk_ID);\n                }\n                EventBus.getInstance().fireEvent(\"prepareNavigation\");\n\n                SyncStorage.set('password', authStore.password);\n                navigation.goBack();\n                authStore.password = \"\";\n                navigation.navigate(\"Main\");\n                setLoading(false);\n                setLoadingTemp(false);\n            }\n        }\n    }\n\n\n    async function _keyboardDidHide() {\n        // alert(\"Keyboard did hide \" + authStore.username.length + \" \" + authStore.password.length);\n        if (!isLoadingTemp && authStore.password.length > 2) {\n            // alert(\"Avant executer onconnected\");\n            setLoadingTemp(true);\n            await onLogin();\n        }\n    }\n\n\n    React.useEffect(() => {\n        // alert(StatusBarManager.HEIGHT);\n\n\n        // alert(StatusBar.currentHeight);\n        if (SyncStorage.get('username')) {\n            authStore.username = SyncStorage.get('username');\n        }\n        // keyboardDidShowListener = Keyboard.addListener('keyboardDidShow', _keyboardDidShow());\n        keyboardDidHideListener = Keyboard.addListener('keyboardDidHide', _keyboardDidHide);\n        return () => {\n            Keyboard.removeListener(\"keyboardDidHide\", _keyboardDidHide);\n        }\n    });\n\n    if (!NetworkUtils.isNetworkAvailable()) {\n        alert(\"Erreur de connexion\");\n    }\n\n    return (\n\n\n        <Root>\n            { isLoading ?\n                <View style={[styles.container, styles.horizontal]}>\n\n                    <ActivityIndicator size=\"large\" color=\"black\" />\n\n                </View>\n\n\n                :\n                <ImageBackground\n                    source={require(\"../assets/images/accueil.png\")}\n                    style={styles.imgBackground}\n\n                >\n                    <Header style={{ width: '100%', backgroundColor: 'transparent' }}>\n                        <Left>\n                            <Button\n                                onPress={() => {\n                                    navigation.goBack();\n                                }}\n                                transparent\n                            >\n                                <Icon name=\"back\" type=\"AntDesign\" style={{ fontSize: 30, marginLeft: 2, color: '#1f4598' }} >\n                                </Icon>\n                            </Button>\n                        </Left>\n                        <Body>\n                            <Text style={{ fontWeight: 'bold' }}> Portail </Text>\n                        </Body>\n                        <Right>\n\n                        </Right>\n                    </Header>\n\n\n                    <Container style={{ flexGrow: 1, flex: 1, backgroundColor: 'transparent' }}>\n\n                        <ScrollView style={{ width: \"100%\" }} contentContainerStyle={styles.content}>\n                            <Content style={{ flexGrow: 1, flex: 1, flexDirection: \"row\" }}>\n\n\n                                <View style={[styles.subContainer, { justifyContent: \"flex-start\" }]}>\n                                    <Form style={styles.form}>\n                                        <Image\n                                            style={{ width: '100%' }}\n                                            resizeMode={\"contain\"}\n                                            source={require(\"../assets/images/vhiculeMedia.png\")}\n                                        />\n\n                                        <TextInput\n                                            placeholderTextColor=\"#404040\"\n                                            style={{ height: 45, width: 200, borderWidth: 0.5, borderColor: '#303030', padding: 7 }}\n                                            value={authStore.username}\n                                            onChange={(e) => (authStore.username = e.nativeEvent.text)}\n                                            placeholder=\"Nom d'utilisateur\"\n                                        />\n\n\n\n                                        <TextInput\n                                            placeholderTextColor=\"#404040\"\n\n                                            secureTextEntry={true}\n                                            value={authStore.password}\n                                            placeholder=\"Mot de passe\"\n                                            onChange={(e) => (authStore.password = e.nativeEvent.text)}\n                                            style={{ marginTop: 10, height: 45, width: 200, borderWidth: 0.5, borderColor: '#303030', padding: 7 }}\n\n                                        />\n\n                                    </Form>\n\n                                    <Button\n                                        onPress={async () => {\n                                            await onLogin()\n                                        }}\n\n                                        style={{ justifyContent: 'center', marginTop: 52, backgroundColor: \"#1f4598\", height: 40, width: '100%', borderWidth: 0.5, borderColor: '#303030', padding: 15 }}\n                                    >\n                                        <Text> Connexion</Text>\n                                    </Button>\n\n                                </View>\n                            </Content>\n                        </ScrollView>\n                    </Container>\n                </ImageBackground>\n            }\n\n\n        </Root >\n    );\n};\nexport default inject(\"authStore\")(observer(LoginScreen));\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        justifyContent: \"center\"\n    },\n    horizontal: {\n        flexDirection: \"row\",\n        justifyContent: \"space-around\",\n        padding: 10\n    },\n\n    imgBackground: {\n        width: \"100%\",\n        height: \"100%\",\n\n    },\n    content: {\n        flexDirection: \"column\",\n        flex: 1,\n        flexGrow: 1,\n        width: \"100%\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n    },\n    button: {\n        width: 200,\n        margin: 20,\n        alignSelf: \"center\",\n        textAlign: \"center\",\n        justifyContent: \"center\",\n        backgroundColor: \"#0F29AC\",\n    },\n    horizontalRule: {\n        borderBottomColor: \"black\",\n        borderBottomWidth: 1,\n        marginTop: 10,\n        marginBottom: 10,\n    },\n    form: {\n        backgroundColor: \"transparent\",\n    },\n    subContainer: {\n        flex: 1,\n\n        justifyContent: \"center\",\n    },\n});\n"]},"metadata":{},"sourceType":"module"}